SolidusQuietLogistics
=====================

SolidusQuietLogistics extension serves to manage the integration with
[Quiet Logistics](http://quietlogistics.com/) as logistics provider for your store.

Installation
------------

Add solidus_quiet_logistics to your Gemfile:

```ruby
gem 'solidus_quiet_logistics'
```

Bundle your dependencies and run the installation generator:

```shell
bundle
bundle exec rails g solidus_quiet_logistics:install
```

Configure your application with the Quiet Logistics credentials

```ruby
# app/config/initializers/quiet_logistics.rb

SolidusQuietLogistics.configure do |config|
  # You can enable or disable quiet logistics integration for each order
  config.enabled = -> (order) { true }

  # Quiet Logistics configuration ( provided by QL )
  config.client_id = 'CLIENT_ID'
  config.business_unit = 'BUSINESS_UNIT'
  config.warehouse = 'WAREHOUSE'

  # Quiet Logistics AWS credentials ( provided by QL )
  config.aws_access_key_id = 'AWS_ACCESS_KEY_ID'
  config.aws_secret_access_key = 'AWS_SECRET_ACCESS_KEY'
  config.aws_region = 'AWS_REGION'
  config.aws_outbox_bucket = 'AWS_OUTBOX_BUCKET'
  config.aws_outbox_queue_url = 'AWS_OUTBOX_QUEUE_URL'
  config.aws_inbox_bucket = 'AWS_INBOX_BUCKET'
  config.aws_inbox_queue_url = 'AWS_INBOX_QUEUE_URL'

  # Order-based customization
  config.order_special_service_amount = 500
  config.order_gift_message = -> (order) do
    order.gift_message if order.gift_message?
  end

  # Shipment-based customization
  config.shipping_attributes = -> (shipment) do
    # Read QL documentation to change the configuration
    # using your shipment/shipping method
    case shipment.shipping_method.code
    when 'Fedex|2 Day'
      attributes[:service_level] = '2DAY'
      attributes[:carrier_name] = 'FEDEX'
      attributes[:order_priority] = 'HIGH'
    when 'FedEx|Ground Home'
      attributes[:service_level] = 'GROUND'
      attributes[:carrier_name] = 'FEDEX'
      attributes[:order_priority] = 'STANDARD'
    else
      raise ArgumentError, 'Unknown shipping method!'
    end

    attributes
  end
end
```

Testing
-------

First bundle your dependencies, then run `rake`. `rake` will default to building the dummy app if it does not exist, then it will run specs, and [Rubocop](https://github.com/bbatsov/rubocop) static code analysis. The dummy app can be regenerated by using `rake test_app`.

```shell
bundle
bundle exec rake
```

When testing your applications integration with this extension you may use it's factories.
Simply add this require statement to your spec_helper:

```ruby
require 'solidus_quiet_logistics/factories'
```

Copyright (c) 2019 [Nebulab](https://www.nebulab.it), released under the New BSD License
